<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìú Today in History</title>

  <base href="/today-in-history-blogger-sh/">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      --bg: #f9f9fb;
      --text: #222;
      --card: #fff;
      --shadow: rgba(0, 0, 0, 0.1);
      --link: #0366d6;
      --hover: #f0f7ff;
    }

    body.dark {
      --bg: #121212;
      --text: #ddd;
      --card: #1e1e1e;
      --shadow: rgba(255, 255, 255, 0.1);
      --link: #66aaff;
      --hover: #1f2937;
    }

    body {
      font-family: "Segoe UI", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }
    header {
      background: var(--card);
      box-shadow: 0 2px 4px var(--shadow);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header .secondary-title {
      font-size: 1.2rem;
      color: var(--text);
      opacity: 0.7;
    }

    /* üåô Toggle button */
    .theme-toggle {
      background: var(--card);
      border: 1px solid #ccc;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .theme-toggle:hover {
      background: var(--hover);
    }

    main {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 1.5rem;
      max-width: 1000px;
      margin: 1rem auto;
      width: 95%;
    }
    .sidebar, .content {
      background: var(--card);
      border-radius: 1rem;
      box-shadow: 0 2px 4px var(--shadow);
      padding: 1rem 1.2rem;
      transition: background 0.3s, color 0.3s;
    }
    .sidebar h2 {
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .sidebar li {
      padding: 0.5rem 0.3rem;
      border-bottom: 1px solid #3333;
      cursor: pointer;
      color: var(--link);
      transition: 0.2s;
    }
    .sidebar li:hover,
    .sidebar li.active {
      background: var(--hover);
    }
    .content h2,
    .content h3 {
      color: var(--text);
    }
    .content p {
      line-height: 1.6;
    }

    /* üì± Mobile floating dropdown */
    #mobileDropdown {
      display: none;
    }
    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      #mobileDropdown {
        display: block;
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--card);
        box-shadow: 0 2px 10px var(--shadow);
        border-radius: 10px;
        padding: 0.5rem;
        z-index: 20;
      }
      #mobileDropdown select {
        font-size: 1rem;
        padding: 0.4rem 0.6rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        background: var(--card);
        color: var(--text);
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="mainTitle">üìú Today in History</h1>
    <div style="display:flex; align-items:center; gap:1rem;">
      <div class="secondary-title">C BC - MMXV AD (100 BC - 2025 AC)</div>
      <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode">üåô</button>
    </div>
  </header>

  <main>
    <aside class="sidebar">
      <h2>üóìÔ∏è Daily Posts</h2>
      <ul id="postList"><li>Loading posts‚Ä¶</li></ul>
    </aside>
    <section class="content" id="content">
      <p>Loading history‚Ä¶</p>
    </section>
  </main>

  <!-- üì± Mobile dropdown -->
  <div id="mobileDropdown">
    <select id="mobilePostSelect">
      <option>Loading posts‚Ä¶</option>
    </select>
  </div>

  <script>
    const postsFolder = "./scripts/posts";

    // üåô Theme toggle setup
    const body = document.body;
    const toggleBtn = document.getElementById("themeToggle");
    const savedTheme = localStorage.getItem("theme");

    if (savedTheme === "dark") {
      body.classList.add("dark");
      toggleBtn.textContent = "‚òÄÔ∏è";
    }

    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark");
      const isDark = body.classList.contains("dark");
      toggleBtn.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    async function loadPosts() {
      const list = document.getElementById("postList");
      const mobileSelect = document.getElementById("mobilePostSelect");

      try {
        const res = await fetch(`${postsFolder}/posts_index.json`);
        if (!res.ok) throw new Error("posts_index.json not found");

        const files = await res.json();
        if (!Array.isArray(files) || files.length === 0) {
          list.innerHTML = "<li>‚ö†Ô∏è No posts available</li>";
          mobileSelect.innerHTML = "<option>‚ö†Ô∏è No posts available</option>";
          return;
        }

        list.innerHTML = "";
        mobileSelect.innerHTML = "";

        files.forEach((f, i) => {
          const datePart = f.replace(".md", "");
          const d = new Date(datePart);
          const label = isNaN(d)
            ? f
            : `${d.toLocaleDateString("en-US", { month: "long" })} ${d.getDate()}`;

          const li = document.createElement("li");
          li.textContent = label;
          li.onclick = () => {
            document.querySelectorAll(".sidebar li").forEach(li => li.classList.remove("active"));
            li.classList.add("active");
            loadPost(f, label);
          };
          if (i === 0) li.classList.add("active");
          list.appendChild(li);

          const opt = document.createElement("option");
          opt.value = f;
          opt.textContent = label;
          mobileSelect.appendChild(opt);
        });

        loadPost(files[0], files[0]);
        mobileSelect.onchange = (e) => {
          const selectedFile = e.target.value;
          loadPost(selectedFile, selectedFile);
        };

      } catch (err) {
        console.error("Error loading posts:", err);
        list.innerHTML = "<li>‚ö†Ô∏è Failed to load posts.</li>";
        mobileSelect.innerHTML = "<option>‚ö†Ô∏è Failed to load posts</option>";
      }
    }

    async function loadPost(file, label) {
      const content = document.getElementById("content");
      try {
        const res = await fetch(`${postsFolder}/${file}`);
        if (!res.ok) throw new Error(`File not found: ${file}`);
        const md = await res.text();
        document.getElementById("mainTitle").textContent = `üìú Today in History`;
        content.innerHTML = marked.parse(md);
      } catch (err) {
        console.error("Error loading post:", err);
        content.innerHTML = "<p>‚ö†Ô∏è Failed to load this post.</p>";
      }
    }

    loadPosts();
  </script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const titles = document.querySelectorAll(".post-title"); // change selector if needed

  // Internal titles (not affected by the duplicate rule)
  const internalPrefixes = ["today in history", "ourown"];

  // Object to track first-two-word groups
  const seen = {};

  titles.forEach(titleEl => {
    const titleText = titleEl.textContent.trim();
    const firstTwo = titleText.split(" ").slice(0, 2).join(" ").toLowerCase();

    // Skip internal app titles
    if (internalPrefixes.some(prefix => titleText.toLowerCase().startsWith(prefix))) {
      return;
    }

    // Count each prefix and hide after two occurrences
    seen[firstTwo] = (seen[firstTwo] || 0) + 1;

    if (seen[firstTwo] > 2) {
      const post = titleEl.closest(".post") || titleEl.parentElement;
      if (post) {
        post.style.display = "none";
      }
    }
  });
});
</script>

</body>
</html>

